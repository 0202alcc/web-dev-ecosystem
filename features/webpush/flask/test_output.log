============================= test session starts ==============================
platform darwin -- Python 3.14.0, pytest-9.0.2, pluggy-1.6.0 -- /Users/aleccandidato/Projects/web-dev-ecosystem/features/webpush/flask/.venv/bin/python3
cachedir: .pytest_cache
rootdir: /Users/aleccandidato/Projects/web-dev-ecosystem/features/webpush/flask
configfile: pyproject.toml
plugins: cov-7.0.0
collecting ... collected 18 items

tests/unit/test_auth_service.py::TestAuthService::test_generate_user_jwt_with_email FAILED [  5%]
tests/unit/test_auth_service.py::TestAuthService::test_generate_user_jwt_with_external_id FAILED [ 11%]
tests/unit/test_auth_service.py::TestAuthService::test_generate_user_jwt_with_both FAILED [ 16%]
tests/unit/test_auth_service.py::TestAuthService::test_generate_user_jwt_without_params_raises_error PASSED [ 22%]
tests/unit/test_auth_service.py::TestAuthService::test_generate_bot_jwt PASSED [ 27%]
tests/unit/test_security.py::TestSecurityUtils::test_validate_ip_prefix_valid PASSED [ 33%]
tests/unit/test_security.py::TestSecurityUtils::test_validate_ip_prefix_invalid PASSED [ 38%]
tests/unit/test_security.py::TestSecurityUtils::test_validate_ip_prefix_empty_ip PASSED [ 44%]
tests/unit/test_security.py::TestSecurityUtils::test_validate_ip_prefix_empty_prefix PASSED [ 50%]
tests/unit/test_security.py::TestSecurityUtils::test_validate_timestamp_valid_recent PASSED [ 55%]
tests/unit/test_security.py::TestSecurityUtils::test_validate_timestamp_invalid_old PASSED [ 61%]
tests/unit/test_security.py::TestSecurityUtils::test_validate_timestamp_invalid_future PASSED [ 66%]
tests/unit/test_security.py::TestSecurityUtils::test_validate_timestamp_invalid_format PASSED [ 72%]
tests/integration/test_api.py::TestAPIEndpoints::test_health_check PASSED [ 77%]
tests/integration/test_api.py::TestAPIEndpoints::test_generate_jwt_with_email FAILED [ 83%]
tests/integration/test_api.py::TestAPIEndpoints::test_generate_jwt_with_external_id FAILED [ 88%]
tests/integration/test_api.py::TestAPIEndpoints::test_generate_jwt_without_params PASSED [ 94%]
tests/integration/test_api.py::TestAPIEndpoints::test_send_notification_unauthorized_ip FAILED [100%]

=================================== FAILURES ===================================
______________ TestAuthService.test_generate_user_jwt_with_email _______________
tests/unit/test_auth_service.py:11: in test_generate_user_jwt_with_email
    token = AuthService.generate_user_jwt(user_email="test@example.com")
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
app/services/auth_service.py:40: in generate_user_jwt
    Config.MAGICBELL_API_SECRET,
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: type object 'Config' has no attribute 'MAGICBELL_API_SECRET'
___________ TestAuthService.test_generate_user_jwt_with_external_id ____________
tests/unit/test_auth_service.py:18: in test_generate_user_jwt_with_external_id
    token = AuthService.generate_user_jwt(user_external_id="usr_test123")
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
app/services/auth_service.py:40: in generate_user_jwt
    Config.MAGICBELL_API_SECRET,
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: type object 'Config' has no attribute 'MAGICBELL_API_SECRET'
_______________ TestAuthService.test_generate_user_jwt_with_both _______________
tests/unit/test_auth_service.py:25: in test_generate_user_jwt_with_both
    token = AuthService.generate_user_jwt(
app/services/auth_service.py:40: in generate_user_jwt
    Config.MAGICBELL_API_SECRET,
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: type object 'Config' has no attribute 'MAGICBELL_API_SECRET'
________________ TestAPIEndpoints.test_generate_jwt_with_email _________________
tests/integration/test_api.py:37: in test_generate_jwt_with_email
    assert response.status_code == 200
E   assert 500 == 200
E    +  where 500 = <WrapperTestResponse streamed [500 INTERNAL SERVER ERROR]>.status_code
------------------------------ Captured log call -------------------------------
ERROR    app.routes.api:api.py:339 Unexpected error: type object 'Config' has no attribute 'MAGICBELL_API_SECRET'
_____________ TestAPIEndpoints.test_generate_jwt_with_external_id ______________
tests/integration/test_api.py:46: in test_generate_jwt_with_external_id
    assert response.status_code == 200
E   assert 500 == 200
E    +  where 500 = <WrapperTestResponse streamed [500 INTERNAL SERVER ERROR]>.status_code
------------------------------ Captured log call -------------------------------
ERROR    app.routes.api:api.py:339 Unexpected error: type object 'Config' has no attribute 'MAGICBELL_API_SECRET'
___________ TestAPIEndpoints.test_send_notification_unauthorized_ip ____________
tests/integration/test_api.py:74: in test_send_notification_unauthorized_ip
    assert response.status_code == 403
E   assert 200 == 403
E    +  where 200 = <WrapperTestResponse streamed [200 OK]>.status_code
------------------------------ Captured log call -------------------------------
ERROR    app.services.push_service:push_service.py:108 Failed to send push notification: WebPushException: Push failed: 400 Bad Request
Response body:{"reason":"VapidPkHashMismatch"}, Response {"reason":"VapidPkHashMismatch"}
=========================== short test summary info ============================
FAILED tests/unit/test_auth_service.py::TestAuthService::test_generate_user_jwt_with_email
FAILED tests/unit/test_auth_service.py::TestAuthService::test_generate_user_jwt_with_external_id
FAILED tests/unit/test_auth_service.py::TestAuthService::test_generate_user_jwt_with_both
FAILED tests/integration/test_api.py::TestAPIEndpoints::test_generate_jwt_with_email
FAILED tests/integration/test_api.py::TestAPIEndpoints::test_generate_jwt_with_external_id
FAILED tests/integration/test_api.py::TestAPIEndpoints::test_send_notification_unauthorized_ip
========================= 6 failed, 12 passed in 1.29s =========================
