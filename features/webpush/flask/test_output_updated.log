============================= test session starts ==============================
platform darwin -- Python 3.14.0, pytest-9.0.2, pluggy-1.6.0 -- /Users/aleccandidato/Projects/web-dev-ecosystem/features/webpush/flask/.venv/bin/python3
cachedir: .pytest_cache
rootdir: /Users/aleccandidato/Projects/web-dev-ecosystem/features/webpush/flask
configfile: pyproject.toml
plugins: cov-7.0.0
collecting ... collected 18 items

tests/unit/test_auth_service.py::TestAuthService::test_generate_user_jwt_with_email PASSED [  5%]
tests/unit/test_auth_service.py::TestAuthService::test_generate_user_jwt_with_external_id PASSED [ 11%]
tests/unit/test_auth_service.py::TestAuthService::test_generate_user_jwt_with_both PASSED [ 16%]
tests/unit/test_auth_service.py::TestAuthService::test_generate_user_jwt_without_params_raises_error PASSED [ 22%]
tests/unit/test_auth_service.py::TestAuthService::test_generate_bot_jwt PASSED [ 27%]
tests/unit/test_security.py::TestSecurityUtils::test_validate_ip_prefix_valid PASSED [ 33%]
tests/unit/test_security.py::TestSecurityUtils::test_validate_ip_prefix_invalid PASSED [ 38%]
tests/unit/test_security.py::TestSecurityUtils::test_validate_ip_prefix_empty_ip PASSED [ 44%]
tests/unit/test_security.py::TestSecurityUtils::test_validate_ip_prefix_empty_prefix PASSED [ 50%]
tests/unit/test_security.py::TestSecurityUtils::test_validate_timestamp_valid_recent PASSED [ 55%]
tests/unit/test_security.py::TestSecurityUtils::test_validate_timestamp_invalid_old PASSED [ 61%]
tests/unit/test_security.py::TestSecurityUtils::test_validate_timestamp_invalid_future PASSED [ 66%]
tests/unit/test_security.py::TestSecurityUtils::test_validate_timestamp_invalid_format PASSED [ 72%]
tests/integration/test_api.py::TestAPIEndpoints::test_health_check PASSED [ 77%]
tests/integration/test_api.py::TestAPIEndpoints::test_generate_jwt_with_email PASSED [ 83%]
tests/integration/test_api.py::TestAPIEndpoints::test_generate_jwt_with_external_id PASSED [ 88%]
tests/integration/test_api.py::TestAPIEndpoints::test_generate_jwt_without_params PASSED [ 94%]
tests/integration/test_api.py::TestAPIEndpoints::test_send_notification_unauthorized_ip FAILED [100%]

=================================== FAILURES ===================================
___________ TestAPIEndpoints.test_send_notification_unauthorized_ip ____________
tests/integration/test_api.py:74: in test_send_notification_unauthorized_ip
    assert response.status_code == 403
E   assert 200 == 403
E    +  where 200 = <WrapperTestResponse streamed [200 OK]>.status_code
------------------------------ Captured log call -------------------------------
ERROR    app.services.push_service:push_service.py:108 Failed to send push notification: WebPushException: Push failed: 400 Bad Request
Response body:{"reason":"VapidPkHashMismatch"}, Response {"reason":"VapidPkHashMismatch"}
=========================== short test summary info ============================
FAILED tests/integration/test_api.py::TestAPIEndpoints::test_send_notification_unauthorized_ip
========================= 1 failed, 17 passed in 0.69s =========================
